
### 执行一条 SQL 查询语句

* 连接器：建立连接，管理连接、校验用户身份；
* 查询缓存：查询语句如果命中查询缓存则直接返回，否则继续往下执行。MySQL 8.0 已删除该模块；
* 解析 SQL，通过解析器对 SQL 查询语句进行词法分析、语法分析，然后构建语法树，方便后续模块读取表名、字段、语句类型；
* 执行 SQL：执行 SQL 共有三个阶段：
  * 预处理阶段：检查表或字段是否存在；将 select * 中的 * 符号扩展为表上的所有列。
  * 优化阶段：基于查询成本的考虑， 选择查询成本最小的执行计划；
  * 执行阶段：根据执行计划执行 SQL 查询语句，从存储引擎读取记录，返回给客户端；

![](./picture/mysql查询流程.webp)

### 执行器
* 用三种方式执行过程
  
方式|示例
:--:|--
主键索引查询| select * from product where id = 1;
全表扫描|select * from product where name = 'iphone';
索引下推|select * from t_user  where age > 20 and reward = 100000;

* 索引下推
  * 联合索引在当遇到范围查询的时候(<,>,between,like)就会停止匹配，前面一个字段可以用到联合索引，后面的字段不能够用到联合索引，就需要每当查询到第一个字段，就需要获取他的主键，然后<font color=red>回表</font>，回表查询到的结果，交给server来判断。在此期间就需要进行很大时间开销。
  * 采用<font color=red>索引下推</font>，将判断两个字段的查询比较都交给了存储引擎，查询到第一个字段有效的时候，再比较第二个字段。如果条件不成立，则直接跳过该二级索引，如果成立，则执行回表操作，将完整的记录返回给server层。
<span color="red">red</span>
